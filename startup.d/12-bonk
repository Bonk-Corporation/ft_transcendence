#!/bin/sh

mkdir -p $HOME/.local/share/godot/export_templates/4.2.2.stable/
mkdir -p backend/bonk-server/pkg
mkdir -p frontend/bonk-client

if [ ! -f "$HOME/.local/share/godot/export_templates/4.2.2.stable/linux_debug.x86_64" ]; then
    wget --no-check-certificate "https://docs.google.com/uc?export=download&id=1yIHSqEMwfKHfkKACKWsc3bGQhbG_Idm9" -O ~/.local/share/godot/export_templates/4.2.2.stable/linux_debug.x86_64
fi

godot4 --display-driver headless --path backend/bonk-server --export-debug server "$PWD"/backend/bonk-server/pkg/bonk-server.x86-64

if [ ! -f "$HOME/.local/share/godot/export_templates/4.2.2.stable/web_debug.zip" ]; then
    wget --no-check-certificate "https://docs.google.com/uc?export=download&id=1TSWOhwXIGD6rxX-5V1ynXsjXUrWQy6xj" -O ~/.local/share/godot/export_templates/4.2.2.stable/web_debug.zip
fi

godot4 --display-driver headless --path backend/bonk-server --export-debug Web "$PWD"/frontend/bonk-client/bonk-client.html
gzip -f frontend/bonk-client/bonk-client.wasm
gzip -f frontend/bonk-client/bonk-client.pck